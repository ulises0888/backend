var ODatabase = require('../lib').ODatabase;

var db = new ODatabase({
   host:     'localhost',
   port:     2424,
   username: 'admin',
   password: 'admin',
   name:     'test'
});


db.open().then(function() {
   return db.query(
"   begin;"+
'LET t0 = CREATE VERTEX V CONTENT {"DisplayName":"Fitness","Active":true,"Position":"fitness_member","Mid":"123","Email":"fitness@local","Created":1471458014668};'+
//'LET t0 = select from v;'+
"LET t1 = UPDATE #11:0 set ref = $t0 ;"+
"LET t2 = UPDATE $t0 SET SponsoredBy = ( SELECT FROM V WHERE Email = 'julia@local' ), Updated = sysdate();"+
'commit retry 100;'+
// 'return  [{"a": $t0, "@type": "d"}, 1] '
"return [$t0, $t1, $t2]"
,{class: 's'}
   );
}).then(function(res){
   console.log(res.length);
   console.log(res);
   db.close().then(function(){
      console.log('closed');
   });
});
